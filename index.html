<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–°–º–∞–π–ª–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }
        
        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            touch-action: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        /* –≠–ö–†–ê–ù–´ */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s;
            z-index: 100;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .start-screen {
            z-index: 200;
        }
        
        .game-screen {
            z-index: 100;
            opacity: 0;
            pointer-events: none;
        }
        
        .game-over-screen {
            z-index: 150;
            opacity: 0;
            pointer-events: none;
            background: rgba(0, 0, 0, 0.95);
        }
        
        /* –ó–ê–ì–û–õ–û–í–û–ö */
        .title {
            font-size: 4.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 900;
        }
        
        .subtitle {
            font-size: 1.3rem;
            margin-bottom: 2.5rem;
            opacity: 0.9;
            text-align: center;
            padding: 0 1rem;
        }
        
        /* –ö–ù–û–ü–ö–ò */
        .btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border: none;
            border-radius: 25px;
            padding: 1.2rem 2.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            margin: 0.5rem;
            transition: all 0.2s;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            min-width: 200px;
        }
        
        .btn:active {
            transform: scale(0.95);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* –•–ï–î–ï–† –ò–ì–†–´ */
        .game-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1.5rem;
            z-index: 90;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .score-container, .next-container {
            text-align: center;
            flex: 1;
        }
        
        .score-label, .next-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 0.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .score-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #FFD700;
        }
        
        .next-emoji {
            font-size: 3rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        
        /* –ò–ì–†–û–í–ê–Ø –û–ë–õ–ê–°–¢–¨ */
        #gameContainer {
            position: fixed;
            top: 80px;
            left: 0;
            width: 100%;
            height: calc(100% - 80px);
            z-index: 50;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.1);
        }
        
        .game-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
        }
        
        /* –°–ú–ê–ô–õ–ò–ö–ò - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –°–¢–ò–õ–ò */
        .emoji-physics {
            position: absolute;
            pointer-events: none;
            user-select: none;
            z-index: 10;
            font-weight: normal;
            text-align: center;
            transform-origin: center;
            display: flex;
            align-items: center;
            justify-content: center;
            will-change: transform;
        }
        
        /* –≠–ö–†–ê–ù –ó–ê–í–ï–†–®–ï–ù–ò–Ø */
        .game-over-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-radius: 30px;
            padding: 2.5rem 2rem;
            text-align: center;
            width: 90%;
            max-width: 350px;
            margin: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }
        
        .final-score {
            font-size: 4rem;
            margin: 1.5rem 0;
            color: #FFD700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            font-weight: 900;
        }
        
        /* –ê–í–¢–û–† */
        .author {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .author a {
            color: #FFD700;
            text-decoration: none;
            font-weight: bold;
        }
        
        /* –ò–ù–°–¢–†–£–ö–¶–ò–ò */
        .instructions {
            margin-top: 2rem;
            font-size: 1rem;
            opacity: 0.9;
            width: 90%;
            max-width: 350px;
            text-align: center;
            line-height: 1.5;
            padding: 0 1rem;
        }
        
        /* –ü–û–î–°–ö–ê–ó–ö–ê TAP */
        .tap-hint {
            position: absolute;
            bottom: 100px;
            font-size: 1.8rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 2px 8px rgba(0,0,0,0.5);
            animation: pulse 1.5s infinite;
            z-index: 100;
            text-align: center;
            padding: 0.5rem 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        @keyframes pulse {
            0% { opacity: 0.4; transform: scale(0.95); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.4; transform: scale(0.95); }
        }
        
        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        @keyframes mergePulse {
            0% { transform: scale(1) translate(-50%, -50%); }
            50% { transform: scale(1.5) translate(-50%, -50%); }
            100% { transform: scale(1) translate(-50%, -50%); }
        }
        
        .merge-effect {
            animation: mergePulse 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        /* –≠–ú–û–ñ–î–ò –î–û–ñ–î–¨ */
        .emoji-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .emoji {
            position: absolute;
            font-size: 2rem;
            animation: fall linear infinite;
            opacity: 0.7;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }
        
        /* –°–¢–ê–¢–£–° –ë–ê–† */
        .status-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: env(safe-area-inset-top, 0px);
            background: rgba(0,0,0,0.3);
            z-index: 95;
        }
        
        /* –°–ï–¢–ö–ê –§–û–ù–û–í–ê–Ø */
        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.05) 2px, transparent 2px),
                radial-gradient(circle at 75% 75%, rgba(255,255,255,0.05) 2px, transparent 2px);
            background-size: 80px 80px;
            pointer-events: none;
            z-index: 1;
            opacity: 0.2;
        }
    </style>
</head>
<body>
    <!-- –°—Ç–∞—Ç—É—Å –±–∞—Ä –¥–ª—è iPhone -->
    <div class="status-bar"></div>
    
    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="screen start-screen" id="startScreen">
        <div class="emoji-rain" id="emojiRain"></div>
        <h1 class="title">–°–ú–ê–ô–õ–ò</h1>
        <p class="subtitle">–ë—Ä–æ—Å–∞–π —Å–º–∞–π–ª–∏–∫–∏,<br>—Å–æ–±–∏—Ä–∞–π –∫–æ–º–±–æ!</p>
        <button class="btn" id="startBtn">–ò–ì–†–ê–¢–¨</button>
        <div class="tap-hint" id="tapHint">üëá –¢–ê–ü–ê–ô –ß–¢–û–ë–´ –ë–†–û–°–ê–¢–¨ üëá</div>
        <p class="instructions">
            –¢–∞–ø–∞–π –≤–Ω–∏–∑—É, —á—Ç–æ–±—ã –±—Ä–æ—Å–∞—Ç—å —Å–º–∞–π–ª–∏–∫–∏.<br>
            –û–Ω–∏ –ø–∞–¥–∞—é—Ç, –∫–∞—Ç—è—Ç—Å—è –∏ —Å–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è!<br>
            –î–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ä—è–¥–æ–º = –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å!
        </p>
    </div>
    
    <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
    <div class="screen game-screen" id="gameScreen">
        <div class="game-header">
            <div class="score-container">
                <div class="score-label">–û—á–∫–∏</div>
                <div class="score-value" id="scoreValue">0</div>
            </div>
            <div class="next-container">
                <div class="next-label">–°–ª–µ–¥—É—é—â–∏–π</div>
                <div class="next-emoji" id="nextEmoji">üòä</div>
            </div>
        </div>
        
        <div class="game-area" id="gameArea"></div>
    </div>
    
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è -->
    <div class="screen game-over-screen" id="gameOverScreen">
        <div class="game-over-content">
            <h2 style="font-size: 2rem; margin-bottom: 1rem;">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê!</h2>
            <div class="score-label" style="font-size: 1.1rem;">–¢–≤–æ–π —Å—á—ë—Ç</div>
            <div class="final-score" id="finalScore">0</div>
            
            <button class="btn" id="playAgainBtn" style="margin-top: 2rem;">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
            
            <div class="author">
                —Å–æ–∑–¥–∞—Ç–µ–ª—å <a href="https://t.me/geyzerrr_A" target="_blank">Geyzerrr</a>
            </div>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —ç–º–æ–¥–∑–∏ -->
    <div id="gameContainer"></div>

    <script>
        // ================= –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =================
        const EMOJI_LEVELS = [
            "üòä",  // –£—Ä–æ–≤–µ–Ω—å 1
            "üòé",  // –£—Ä–æ–≤–µ–Ω—å 2  
            "ü•≥",  // –£—Ä–æ–≤–µ–Ω—å 3
            "ü§©",  // –£—Ä–æ–≤–µ–Ω—å 4
            "ü§ë",  // –£—Ä–æ–≤–µ–Ω—å 5
            "ü§Ø",  // –£—Ä–æ–≤–µ–Ω—å 6
            "üëë"   // –£—Ä–æ–≤–µ–Ω—å 7 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π)
        ];
        
        const EMOJI_RAIN = ["üòä", "üòé", "ü•≥", "ü§©", "ü§ë", "ü§Ø", "üëë", "üòÅ", "üòç", "ü•∞"];
        
        const POINTS_PER_LEVEL = [10, 30, 80, 200, 500, 1200, 3000];
        
        // –†–∞–∑–º–µ—Ä—ã —Å–º–∞–π–ª–∏–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
        const EMOJI_SIZES = [45, 60, 75, 95, 120, 150, 190];
        
        // ================= –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ =================
        let gameState = {
            emojis: [],
            nextEmoji: 1,
            score: 0,
            combo: 1.0,
            moves: 0,
            gameOver: false,
            lastMergeChain: 0,
            gravity: 0.8,
            friction: 0.96,
            bounce: 0.65,
            maxEmojis: 35,
            physicsRunning: true,
            lastPhysicsTime: 0
        };
        
        // ================= –î–û–ú-–≠–õ–ï–ú–ï–ù–¢–´ =================
        const startScreen = document.getElementById('startScreen');
        const gameScreen = document.getElementById('gameScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const scoreValue = document.getElementById('scoreValue');
        const nextEmoji = document.getElementById('nextEmoji');
        const finalScore = document.getElementById('finalScore');
        const emojiRain = document.getElementById('emojiRain');
        const tapHint = document.getElementById('tapHint');
        const gameContainer = document.getElementById('gameContainer');
        const gameArea = document.getElementById('gameArea');
        
        // ================= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =================
        function init() {
            createEmojiRain();
            setupEventListeners();
            resetGame();
            startPhysicsLoop();
        }
        
        function createEmojiRain() {
            for (let i = 0; i < 15; i++) {
                setTimeout(() => createFallingEmoji(), i * 400);
            }
            setInterval(createFallingEmoji, 1000);
        }
        
        function createFallingEmoji() {
            const emoji = document.createElement('div');
            emoji.className = 'emoji';
            emoji.textContent = EMOJI_RAIN[Math.floor(Math.random() * EMOJI_RAIN.length)];
            emoji.style.left = Math.random() * 100 + '%';
            emoji.style.fontSize = (Math.random() * 25 + 20) + 'px';
            emoji.style.animationDuration = (Math.random() * 3 + 4) + 's';
            emojiRain.appendChild(emoji);
            
            setTimeout(() => emoji.remove(), 8000);
        }
        
        function setupEventListeners() {
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('playAgainBtn').addEventListener('click', startGame);
            
            // –¢–∞–ø –ø–æ –∏–≥—Ä–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏
            gameContainer.addEventListener('click', handleGameAreaTap);
            gameContainer.addEventListener('touchstart', handleGameAreaTouch, { passive: false });
        }
        
        // ================= –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê =================
        
        function startGame() {
            resetGame();
            clearGameContainer();
            
            startScreen.style.opacity = '0';
            startScreen.style.pointerEvents = 'none';
            gameOverScreen.style.opacity = '0';
            gameOverScreen.style.pointerEvents = 'none';
            
            setTimeout(() => {
                gameScreen.style.opacity = '1';
                gameScreen.style.pointerEvents = 'auto';
                gameState.physicsRunning = true;
            }, 300);
        }
        
        function resetGame() {
            gameState = {
                emojis: [],
                nextEmoji: getRandomEmojiLevel(),
                score: 0,
                combo: 1.0,
                moves: 0,
                gameOver: false,
                lastMergeChain: 0,
                gravity: 0.8,
                friction: 0.96,
                bounce: 0.65,
                maxEmojis: 35,
                physicsRunning: true,
                lastPhysicsTime: 0
            };
            
            updateUI();
        }
        
        function clearGameContainer() {
            gameContainer.innerHTML = '';
        }
        
        function getRandomEmojiLevel() {
            const rand = Math.random();
            if (rand < 0.7) return 1;
            if (rand < 0.9) return 2;
            if (rand < 0.97) return 3;
            return 4;
        }
        
        // ================= –û–ë–†–ê–ë–û–¢–ö–ê –¢–ê–ü–û–í =================
        
        function handleGameAreaTap(e) {
            if (gameState.gameOver || !gameState.physicsRunning) return;
            
            const rect = gameContainer.getBoundingClientRect();
            const x = e.clientX;
            // –ë—Ä–æ—Å–∞–µ–º —Å–º–∞–π–ª–∏–∫–∏ –Ω–µ–º–Ω–æ–≥–æ –≤—ã—à–µ –º–µ—Å—Ç–∞ —Ç–∞–ø–∞
            const y = Math.min(e.clientY, rect.bottom - 100);
            
            if (y > rect.top && y < rect.bottom) {
                createEmojiAt(x, y);
            }
        }
        
        function handleGameAreaTouch(e) {
            e.preventDefault();
            if (gameState.gameOver || !gameState.physicsRunning) return;
            
            const touch = e.touches[0];
            const rect = gameContainer.getBoundingClientRect();
            const x = touch.clientX;
            const y = Math.min(touch.clientY, rect.bottom - 100);
            
            if (y > rect.top && y < rect.bottom) {
                createEmojiAt(x, y);
            }
        }
        
        // ================= –°–û–ó–î–ê–ù–ò–ï –≠–ú–û–î–ó–ò =================
        
        function createEmojiAt(x, y) {
            gameState.moves++;
            
            const level = gameState.nextEmoji;
            const size = EMOJI_SIZES[level - 1];
            
            // –°–æ–∑–¥–∞–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç (–£–ü–†–û–©–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø)
            const emojiElement = document.createElement('div');
            emojiElement.className = 'emoji-physics';
            emojiElement.textContent = EMOJI_LEVELS[level - 1];
            emojiElement.style.fontSize = `${size}px`;
            emojiElement.style.width = `${size}px`;
            emojiElement.style.height = `${size}px`;
            emojiElement.style.lineHeight = `${size}px`;
            emojiElement.style.left = `${x}px`;
            emojiElement.style.top = `${y}px`;
            emojiElement.style.transform = 'translate(-50%, -50%)';
            
            // –°—Ç–∏–ª–∏ –¥–ª—è —É—Ä–æ–≤–Ω—è
            applyEmojiStyles(emojiElement, level);
            
            gameContainer.appendChild(emojiElement);
            
            // –°–æ–∑–¥–∞–µ–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç
            const physicsEmoji = {
                element: emojiElement,
                level: level,
                x: x,
                y: y,
                vx: (Math.random() - 0.5) * 8,
                vy: (Math.random() - 0.5) * 4 - 8,
                radius: size / 2,
                size: size,
                rotation: 0,
                rotationSpeed: (Math.random() - 0.5) * 20,
                merged: false,
                id: Date.now() + Math.random()
            };
            
            gameState.emojis.push(physicsEmoji);
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–º–æ–¥–∑–∏
            gameState.nextEmoji = getRandomEmojiLevel();
            
            updateUI();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª–∏—è–Ω–∏—è
            setTimeout(() => checkForMerges(), 300);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã
            checkGameOver();
        }
        
        function applyEmojiStyles(element, level) {
            // –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏
            element.style.color = 'white';
            element.style.textShadow = '0 2px 4px rgba(0,0,0,0.5)';
            
            // –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö —É—Ä–æ–≤–Ω–µ–π
            switch(level) {
                case 4:
                    element.style.filter = 'drop-shadow(0 0 10px gold)';
                    element.style.textShadow = '0 0 15px gold, 0 2px 4px rgba(0,0,0,0.5)';
                    break;
                case 5:
                    element.style.filter = 'drop-shadow(0 0 15px orange) brightness(1.1)';
                    element.style.textShadow = '0 0 20px orange, 0 0 10px gold, 0 2px 4px rgba(0,0,0,0.5)';
                    break;
                case 6:
                    element.style.filter = 'drop-shadow(0 0 20px red) brightness(1.2)';
                    element.style.textShadow = '0 0 25px red, 0 0 15px orange, 0 2px 4px rgba(0,0,0,0.5)';
                    break;
                case 7:
                    element.style.filter = 'drop-shadow(0 0 25px gold) brightness(1.3)';
                    element.style.textShadow = '0 0 30px gold, 0 0 20px white, 0 2px 4px rgba(0,0,0,0.5)';
                    break;
            }
        }
        
        // ================= –§–ò–ó–ò–ß–ï–°–ö–ò–ô –î–í–ò–ñ–û–ö =================
        
        function startPhysicsLoop() {
            function update() {
                if (gameState.physicsRunning && !gameState.gameOver) {
                    const currentTime = Date.now();
                    const deltaTime = Math.min((currentTime - gameState.lastPhysicsTime) / 16.67, 2);
                    gameState.lastPhysicsTime = currentTime;
                    
                    updatePhysics(deltaTime);
                    renderEmojis();
                }
                
                requestAnimationFrame(update);
            }
            
            gameState.lastPhysicsTime = Date.now();
            requestAnimationFrame(update);
        }
        
        function updatePhysics(deltaTime) {
            const containerRect = gameContainer.getBoundingClientRect();
            const floorY = containerRect.bottom - 20;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π —ç–º–æ–¥–∑–∏
            for (let i = 0; i < gameState.emojis.length; i++) {
                const emoji = gameState.emojis[i];
                if (emoji.merged) continue;
                
                // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
                emoji.vy += gameState.gravity * deltaTime;
                
                // –¢—Ä–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω–∞ –∑–µ–º–ª–µ)
                const isOnGround = emoji.y + emoji.radius >= floorY - 5;
                if (isOnGround) {
                    emoji.vx *= Math.pow(gameState.friction, deltaTime);
                    if (Math.abs(emoji.vx) < 0.2) emoji.vx = 0;
                    emoji.rotationSpeed *= 0.95;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é
                emoji.x += emoji.vx * deltaTime;
                emoji.y += emoji.vy * deltaTime;
                
                // –í—Ä–∞—â–µ–Ω–∏–µ
                emoji.rotation += emoji.rotationSpeed * deltaTime;
                
                // –ì—Ä–∞–Ω–∏—Ü—ã —ç–∫—Ä–∞–Ω–∞
                const leftBound = containerRect.left + emoji.radius;
                const rightBound = containerRect.right - emoji.radius;
                
                if (emoji.x < leftBound) {
                    emoji.x = leftBound;
                    emoji.vx = Math.abs(emoji.vx) * gameState.bounce;
                }
                if (emoji.x > rightBound) {
                    emoji.x = rightBound;
                    emoji.vx = -Math.abs(emoji.vx) * gameState.bounce;
                }
                
                // –ü–æ–ª
                if (emoji.y + emoji.radius > floorY) {
                    emoji.y = floorY - emoji.radius;
                    emoji.vy = -Math.abs(emoji.vy) * gameState.bounce;
                    
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ—Å–ª–∏ –ø–æ—á—Ç–∏ –Ω–µ –¥–≤–∏–≥–∞–µ—Ç—Å—è
                    if (Math.abs(emoji.vy) < 0.8) {
                        emoji.vy = 0;
                    }
                }
            }
            
            // –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–ª–ª–∏–∑–∏–π
            resolveCollisions();
            
            // –£–¥–∞–ª—è–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —ç–º–æ–¥–∑–∏
            gameState.emojis = gameState.emojis.filter(e => {
                if (e.merged) {
                    if (e.element && e.element.parentNode) {
                        e.element.remove();
                    }
                    return false;
                }
                return true;
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª–∏—è–Ω–∏—è
            checkForMerges();
        }
        
        function resolveCollisions() {
            for (let i = 0; i < gameState.emojis.length; i++) {
                const a = gameState.emojis[i];
                if (a.merged) continue;
                
                for (let j = i + 1; j < gameState.emojis.length; j++) {
                    const b = gameState.emojis[j];
                    if (b.merged) continue;
                    
                    const dx = a.x - b.x;
                    const dy = a.y - b.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const minDistance = a.radius + b.radius;
                    
                    if (distance < minDistance) {
                        // –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–ª–ª–∏–∑–∏–∏ - –æ—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏–µ
                        const angle = Math.atan2(dy, dx);
                        const overlap = (minDistance - distance) * 0.5;
                        
                        // –°–¥–≤–∏–≥–∞–µ–º –æ–±–∞ —ç–º–æ–¥–∑–∏
                        a.x += Math.cos(angle) * overlap;
                        a.y += Math.sin(angle) * overlap;
                        b.x -= Math.cos(angle) * overlap;
                        b.y -= Math.sin(angle) * overlap;
                        
                        // –û–±–º–µ–Ω –∏–º–ø—É–ª—å—Å–∞–º–∏
                        const totalMass = a.radius + b.radius;
                        const aMass = a.radius / totalMass;
                        const bMass = b.radius / totalMass;
                        
                        const vxDiff = a.vx - b.vx;
                        const vyDiff = a.vy - b.vy;
                        
                        if (dx * vxDiff + dy * vyDiff < 0) {
                            const impulse = 2 * (vxDiff * dx + vyDiff * dy) / (distance * distance);
                            
                            a.vx -= impulse * bMass * dx;
                            a.vy -= impulse * bMass * dy;
                            b.vx += impulse * aMass * dx;
                            b.vy += impulse * aMass * dy;
                        }
                    }
                }
            }
        }
        
        function renderEmojis() {
            for (const emoji of gameState.emojis) {
                if (emoji.element && !emoji.merged) {
                    emoji.element.style.left = `${emoji.x}px`;
                    emoji.element.style.top = `${emoji.y}px`;
                    emoji.element.style.transform = `translate(-50%, -50%) rotate(${emoji.rotation}deg)`;
                }
            }
        }
        
        // ================= –°–õ–ò–Ø–ù–ò–Ø =================
        
        function checkForMerges() {
            if (gameState.gameOver) return;
            
            let merged = false;
            
            for (let i = 0; i < gameState.emojis.length; i++) {
                const a = gameState.emojis[i];
                if (a.merged) continue;
                
                for (let j = i + 1; j < gameState.emojis.length; j++) {
                    const b = gameState.emojis[j];
                    if (b.merged) continue;
                    
                    // –°–ª–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —É—Ä–æ–≤–Ω–∏
                    if (a.level === b.level) {
                        const dx = a.x - b.x;
                        const dy = a.y - b.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        const mergeDistance = (a.radius + b.radius) * 0.8;
                        
                        if (distance < mergeDistance) {
                            mergeEmojis(a, b);
                            merged = true;
                            break;
                        }
                    }
                }
                
                if (merged) break;
            }
            
            if (merged) {
                gameState.lastMergeChain++;
                gameState.combo = Math.min(4.0, 1.0 + gameState.lastMergeChain * 0.15);
                updateUI();
            } else {
                gameState.lastMergeChain = 0;
                gameState.combo = 1.0;
                updateUI();
            }
        }
        
        function mergeEmojis(a, b) {
            a.merged = true;
            b.merged = true;
            
            const newLevel = Math.min(a.level + 1, EMOJI_LEVELS.length);
            const points = POINTS_PER_LEVEL[a.level - 1] * gameState.combo;
            gameState.score += Math.round(points);
            
            const centerX = (a.x + b.x) / 2;
            const centerY = (a.y + b.y) / 2;
            const newSize = EMOJI_SIZES[newLevel - 1];
            
            // –≠—Ñ—Ñ–µ–∫—Ç —Å–ª–∏—è–Ω–∏—è
            if (a.element) a.element.classList.add('merge-effect');
            if (b.element) b.element.classList.add('merge-effect');
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Å–º–∞–π–ª–∏–∫ —á–µ—Ä–µ–∑ 0.3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ
                if (a.element && a.element.parentNode) a.element.remove();
                if (b.element && b.element.parentNode) b.element.remove();
                
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
                const newEmoji = document.createElement('div');
                newEmoji.className = 'emoji-physics';
                newEmoji.textContent = EMOJI_LEVELS[newLevel - 1];
                newEmoji.style.fontSize = `${newSize}px`;
                newEmoji.style.width = `${newSize}px`;
                newEmoji.style.height = `${newSize}px`;
                newEmoji.style.lineHeight = `${newSize}px`;
                newEmoji.style.left = `${centerX}px`;
                newEmoji.style.top = `${centerY}px`;
                newEmoji.style.transform = 'translate(-50%, -50%) scale(0)';
                
                applyEmojiStyles(newEmoji, newLevel);
                
                gameContainer.appendChild(newEmoji);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
                setTimeout(() => {
                    newEmoji.style.transition = 'transform 0.4s ease-out';
                    newEmoji.style.transform = 'translate(-50%, -50%) scale(1)';
                }, 10);
                
                // –°–æ–∑–¥–∞–µ–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç
                const physicsEmoji = {
                    element: newEmoji,
                    level: newLevel,
                    x: centerX,
                    y: centerY,
                    vx: (Math.random() - 0.5) * 6,
                    vy: -Math.random() * 8,
                    radius: newSize / 2,
                    size: newSize,
                    rotation: 0,
                    rotationSpeed: (Math.random() - 0.5) * 25,
                    merged: false,
                    id: Date.now() + Math.random()
                };
                
                gameState.emojis.push(physicsEmoji);
                
                updateUI();
                
                // –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏—è
                for (const emoji of gameState.emojis) {
                    if (emoji !== physicsEmoji && !emoji.merged) {
                        const dx = emoji.x - centerX;
                        const dy = emoji.y - centerY;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 150) {
                            const force = 200 / (distance + 1);
                            emoji.vx += (dx / distance) * force;
                            emoji.vy += (dy / distance) * force;
                        }
                    }
                }
                
            }, 300);
        }
        
        // ================= –ö–û–ù–ï–¶ –ò–ì–†–´ =================
        
        function checkGameOver() {
            if (gameState.gameOver) return;
            
            const containerRect = gameContainer.getBoundingClientRect();
            const screenHeight = containerRect.height;
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π —Å–º–∞–π–ª–∏–∫
            let highestY = 0;
            for (const emoji of gameState.emojis) {
                if (!emoji.merged && emoji.y - emoji.radius < highestY) {
                    highestY = emoji.y - emoji.radius;
                }
            }
            
            // –ï—Å–ª–∏ —Å–º–∞–π–ª–∏–∫–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –≤–µ—Ä—Ö–∞ —ç–∫—Ä–∞–Ω–∞
            const topThreshold = containerRect.top + 100;
            if (highestY < topThreshold || gameState.emojis.length >= gameState.maxEmojis) {
                endGame();
            }
        }
        
        function endGame() {
            gameState.gameOver = true;
            gameState.physicsRunning = false;
            
            setTimeout(() => {
                gameScreen.style.opacity = '0';
                gameScreen.style.pointerEvents = 'none';
                
                finalScore.textContent = gameState.score;
                gameOverScreen.style.opacity = '1';
                gameOverScreen.style.pointerEvents = 'auto';
            }, 1000);
        }
        
        // ================= –û–ë–ù–û–í–õ–ï–ù–ò–ï UI =================
        
        function updateUI() {
            scoreValue.textContent = gameState.score;
            nextEmoji.textContent = EMOJI_LEVELS[gameState.nextEmoji - 1];
            nextEmoji.style.fontSize = `${EMOJI_SIZES[gameState.nextEmoji - 1] * 0.8}px`;
        }
        
        // ================= –ó–ê–ü–£–°–ö =================
        
        window.addEventListener('DOMContentLoaded', init);
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–∞—Å–∞–Ω–∏–π
        document.addEventListener('touchmove', (e) => {
            if (e.target === gameContainer) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã
        window.addEventListener('resize', () => {
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏–∏ —ç–º–æ–¥–∑–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
            const containerRect = gameContainer.getBoundingClientRect();
            for (const emoji of gameState.emojis) {
                if (emoji.x < containerRect.left + emoji.radius) {
                    emoji.x = containerRect.left + emoji.radius;
                }
                if (emoji.x > containerRect.right - emoji.radius) {
                    emoji.x = containerRect.right - emoji.radius;
                }
            }
        });
    </script>
</body>
</html>
