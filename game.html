<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°–º–∞–π–ª–∏ - Smiley Merge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        body {
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s;
        }
        
        .start-screen {
            z-index: 10;
        }
        
        .game-screen {
            z-index: 5;
            opacity: 0;
            pointer-events: none;
        }
        
        .game-over-screen {
            z-index: 5;
            opacity: 0;
            pointer-events: none;
            background: rgba(0, 0, 0, 0.85);
        }
        
        .title {
            font-size: 4rem;
            margin-bottom: 1rem;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.8;
        }
        
        .btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border: none;
            border-radius: 50px;
            padding: 1rem 2rem;
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            margin: 0.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover, .btn:active {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn-small {
            padding: 0.7rem 1.5rem;
            font-size: 1rem;
        }
        
        .emoji-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .emoji {
            position: absolute;
            font-size: 2rem;
            animation: fall linear infinite;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }
        
        .game-header {
            width: 100%;
            max-width: 500px;
            display: flex;
            justify-content: space-between;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .score-container, .next-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            text-align: center;
            min-width: 120px;
        }
        
        .score-label, .next-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }
        
        .score-value {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .next-emoji {
            font-size: 2.5rem;
        }
        
        .grid-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 15px;
            margin: 0 1rem;
        }
        
        #gameGrid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 5px;
            width: min(90vw, 400px);
            height: min(90vw, 400px);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 5px;
        }
        
        .cell {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .cell:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .cell.empty:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .emoji-cell {
            font-size: 1.5rem;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes popIn {
            0% { transform: scale(0); }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .merge-effect {
            animation: mergePulse 0.5s;
        }
        
        @keyframes mergePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .game-over-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            max-width: 400px;
            margin: 1rem;
        }
        
        .final-score {
            font-size: 3rem;
            margin: 1rem 0;
            color: #FFD700;
        }
        
        .author {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .author a {
            color: #FFD700;
            text-decoration: none;
        }
        
        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .share-btn {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .share-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.1);
        }
        
        .tg-icon::after {
            content: "üì±";
        }
        
        .vk-icon::after {
            content: "üë•";
        }
        
        .instructions {
            margin-top: 1rem;
            font-size: 0.9rem;
            opacity: 0.8;
            max-width: 400px;
            text-align: center;
            line-height: 1.4;
            padding: 0 1rem;
        }
        
        @media (max-width: 500px) {
            .title {
                font-size: 3rem;
            }
            
            .game-header {
                flex-direction: column;
                align-items: center;
                gap: 0.5rem;
            }
            
            .score-container, .next-container {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="screen start-screen" id="startScreen">
        <div class="emoji-rain" id="emojiRain"></div>
        <h1 class="title">–°–º–∞–π–ª–∏</h1>
        <p class="subtitle">Smiley Merge Game</p>
        <button class="btn" id="startBtn">START</button>
        <p class="instructions">
            –¢–∞–ø–∞–π –ø–æ –ø—É—Å—Ç—ã–º –∫–ª–µ—Ç–∫–∞–º, —á—Ç–æ–±—ã —Ä–∞–∑–º–µ—â–∞—Ç—å —Å–º–∞–π–ª–∏–∫–∏.<br>
            –î–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ä—è–¥–æ–º —Å–ª–∏–≤–∞—é—Ç—Å—è –≤ –Ω–æ–≤—ã–π!<br>
            –ò–≥—Ä–∞ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –º–µ—Å—Ç–∞.
        </p>
    </div>
    
    <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
    <div class="screen game-screen" id="gameScreen">
        <div class="game-header">
            <div class="score-container">
                <div class="score-label">–û–ß–ö–ò</div>
                <div class="score-value" id="scoreValue">0</div>
            </div>
            <div class="next-container">
                <div class="next-label">–°–õ–ï–î–£–Æ–©–ò–ô</div>
                <div class="next-emoji" id="nextEmoji">üòä</div>
            </div>
        </div>
        
        <div class="grid-container">
            <div id="gameGrid"></div>
        </div>
        
        <div class="instructions">
            –°—á—ë—Ç: <span id="currentScore">0</span> | 
            –ö–æ–º–±–æ: <span id="comboValue">x1.0</span> | 
            –•–æ–¥–æ–≤: <span id="movesCount">0</span>
        </div>
    </div>
    
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã -->
    <div class="screen game-over-screen" id="gameOverScreen">
        <div class="game-over-content">
            <h2>–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê!</h2>
            <div class="final-score" id="finalScore">0</div>
            <p>–¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</p>
            
            <button class="btn" id="playAgainBtn">–ò–ì–†–ê–¢–¨ –ï–©–Å</button>
            
            <div class="share-buttons">
                <div class="share-btn tg-icon" id="shareTgBtn" title="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ Telegram"></div>
                <div class="share-btn vk-icon" id="shareVkBtn" title="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ –í–ö"></div>
            </div>
            
            <div class="author">
                –∞–≤—Ç–æ—Ä <a href="https://t.me/geyzerrr_A" target="_blank">Geyzerrr</a>
            </div>
        </div>
    </div>

    <script>
        // ================= –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =================
        const EMOJI_LEVELS = [
            "üòä",  // –£—Ä–æ–≤–µ–Ω—å 1
            "üòé",  // –£—Ä–æ–≤–µ–Ω—å 2  
            "ü•≥",  // –£—Ä–æ–≤–µ–Ω—å 3
            "ü§©",  // –£—Ä–æ–≤–µ–Ω—å 4
            "ü§ë",  // –£—Ä–æ–≤–µ–Ω—å 5
            "ü§Ø",  // –£—Ä–æ–≤–µ–Ω—å 6
            "üëë"   // –£—Ä–æ–≤–µ–Ω—å 7 (–ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π)
        ];
        
        const EMOJI_RAIN = ["üòä", "üòé", "ü•≥", "ü§©", "ü§ë", "ü§Ø", "üëë", "üòÅ", "üòç", "ü•∞", "ü§î", "üò¥", "ü§™", "ü•∫"];
        
        const GRID_SIZE = 8;
        const POINTS_PER_LEVEL = [10, 25, 50, 100, 250, 500, 1000];
        
        // ================= –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ =================
        let gameState = {
            grid: Array(GRID_SIZE).fill().map(() => Array(GRID_SIZE).fill(0)),
            nextEmoji: 1,
            score: 0,
            combo: 1.0,
            moves: 0,
            gameOver: false,
            lastMergeChain: 0
        };
        
        // ================= –î–û–ú-–≠–õ–ï–ú–ï–ù–¢–´ =================
        const startScreen = document.getElementById('startScreen');
        const gameScreen = document.getElementById('gameScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const gameGrid = document.getElementById('gameGrid');
        const scoreValue = document.getElementById('scoreValue');
        const nextEmoji = document.getElementById('nextEmoji');
        const currentScore = document.getElementById('currentScore');
        const comboValue = document.getElementById('comboValue');
        const movesCount = document.getElementById('movesCount');
        const finalScore = document.getElementById('finalScore');
        const emojiRain = document.getElementById('emojiRain');
        
        // ================= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =================
        function init() {
            createEmojiRain();
            createGrid();
            setupEventListeners();
            resetGame();
        }
        
        // –°–æ–∑–¥–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç –ø–∞–¥–∞—é—â–∏—Ö —ç–º–æ–¥–∑–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º —ç–∫—Ä–∞–Ω–µ
        function createEmojiRain() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.className = 'emoji';
                    emoji.textContent = EMOJI_RAIN[Math.floor(Math.random() * EMOJI_RAIN.length)];
                    emoji.style.left = Math.random() * 100 + '%';
                    emoji.style.fontSize = (Math.random() * 2 + 1) + 'rem';
                    emoji.style.animationDuration = (Math.random() * 5 + 5) + 's';
                    emoji.style.animationDelay = Math.random() * 2 + 's';
                    emojiRain.appendChild(emoji);
                    
                    // –£–¥–∞–ª—è–µ–º —ç–º–æ–¥–∑–∏ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
                    setTimeout(() => {
                        emoji.remove();
                    }, parseFloat(emoji.style.animationDuration) * 1000);
                }, i * 300);
            }
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —ç–º–æ–¥–∑–∏
            setInterval(() => {
                if (startScreen.style.opacity === '1') {
                    const emoji = document.createElement('div');
                    emoji.className = 'emoji';
                    emoji.textContent = EMOJI_RAIN[Math.floor(Math.random() * EMOJI_RAIN.length)];
                    emoji.style.left = Math.random() * 100 + '%';
                    emoji.style.fontSize = (Math.random() * 2 + 1) + 'rem';
                    emoji.style.animationDuration = (Math.random() * 5 + 5) + 's';
                    emojiRain.appendChild(emoji);
                    
                    setTimeout(() => {
                        emoji.remove();
                    }, parseFloat(emoji.style.animationDuration) * 1000);
                }
            }, 800);
        }
        
        // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–≤—É—é —Å–µ—Ç–∫—É
        function createGrid() {
            gameGrid.innerHTML = '';
            for (let row = 0; row < GRID_SIZE; row++) {
                for (let col = 0; col < GRID_SIZE; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell empty';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    gameGrid.appendChild(cell);
                }
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('playAgainBtn').addEventListener('click', startGame);
            document.getElementById('shareTgBtn').addEventListener('click', shareTelegram);
            document.getElementById('shareVkBtn').addEventListener('click', shareVK);
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Å–µ—Ç–∫–µ
            gameGrid.addEventListener('click', handleGridClick);
            
            // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–≤–∞–π–ø–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            let touchStartX, touchStartY;
            gameGrid.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                e.preventDefault();
            }, { passive: false });
            
            gameGrid.addEventListener('touchend', (e) => {
                if (!touchStartX || !touchStartY) return;
                
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                
                const diffX = touchEndX - touchStartX;
                const diffY = touchEndY - touchStartY;
                
                // –ï—Å–ª–∏ —Å–≤–∞–π–ø –Ω–µ–±–æ–ª—å—à–æ–π, —Å—á–∏—Ç–∞–µ–º —ç—Ç–æ –∫–ª–∏–∫–æ–º
                if (Math.abs(diffX) < 30 && Math.abs(diffY) < 30) {
                    const target = document.elementFromPoint(touchEndX, touchEndY);
                    if (target && target.classList.contains('cell')) {
                        handleCellClick(target);
                    }
                }
                
                touchStartX = null;
                touchStartY = null;
                e.preventDefault();
            }, { passive: false });
        }
        
        // ================= –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê =================
        
        // –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–π –∏–≥—Ä—ã
        function startGame() {
            resetGame();
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω—ã
            startScreen.style.opacity = '0';
            startScreen.style.pointerEvents = 'none';
            
            gameOverScreen.style.opacity = '0';
            gameOverScreen.style.pointerEvents = 'none';
            
            setTimeout(() => {
                gameScreen.style.opacity = '1';
                gameScreen.style.pointerEvents = 'auto';
            }, 300);
            
            renderGrid();
        }
        
        // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        function resetGame() {
            gameState = {
                grid: Array(GRID_SIZE).fill().map(() => Array(GRID_SIZE).fill(0)),
                nextEmoji: getRandomEmojiLevel(),
                score: 0,
                combo: 1.0,
                moves: 0,
                gameOver: false,
                lastMergeChain: 0
            };
            
            updateUI();
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è —ç–º–æ–¥–∑–∏ (–±–æ–ª—å—à–µ —à–∞–Ω—Å–æ–≤ –Ω–∞ –Ω–∏–∑–∫–∏–µ —É—Ä–æ–≤–Ω–∏)
        function getRandomEmojiLevel() {
            const rand = Math.random();
            if (rand < 0.6) return 1;      // 60% - —É—Ä–æ–≤–µ–Ω—å 1
            if (rand < 0.85) return 2;     // 25% - —É—Ä–æ–≤–µ–Ω—å 2
            if (rand < 0.95) return 3;     // 10% - —É—Ä–æ–≤–µ–Ω—å 3
            return 4;                      // 5% - —É—Ä–æ–≤–µ–Ω—å 4
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —Å–µ—Ç–∫–µ
        function handleGridClick(e) {
            if (gameState.gameOver) return;
            
            const cell = e.target;
            if (!cell.classList.contains('cell')) return;
            
            handleCellClick(cell);
        }
        
        function handleCellClick(cell) {
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–µ—Ç–∫–∞ –ø—É—Å—Ç–∞—è
            if (gameState.grid[row][col] !== 0) return;
            
            // –†–∞–∑–º–µ—â–∞–µ–º —ç–º–æ–¥–∑–∏
            placeEmoji(row, col);
        }
        
        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ –Ω–∞ –ø–æ–ª–µ
        function placeEmoji(row, col) {
            gameState.grid[row][col] = gameState.nextEmoji;
            gameState.moves++;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª–∏—è–Ω–∏–µ
            const mergeResult = checkAndMerge(row, col);
            
            // –ï—Å–ª–∏ –±—ã–ª–æ —Å–ª–∏—è–Ω–∏–µ, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–º–±–æ
            if (mergeResult.merged) {
                gameState.lastMergeChain++;
                gameState.combo = Math.min(3.0, 1.0 + gameState.lastMergeChain * 0.1);
            } else {
                gameState.lastMergeChain = 0;
                gameState.combo = 1.0;
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é
            applyGravity();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª–∏—è–Ω–∏—è –ø–æ—Å–ª–µ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏ (—Ü–µ–ø–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è)
            let chainReaction = true;
            let chainCount = 0;
            
            while (chainReaction && chainCount < 5) { // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ü–µ–ø–Ω—É—é —Ä–µ–∞–∫—Ü–∏—é
                chainReaction = false;
                
                for (let r = 0; r < GRID_SIZE; r++) {
                    for (let c = 0; c < GRID_SIZE; c++) {
                        if (gameState.grid[r][c] !== 0) {
                            const result = checkAndMerge(r, c);
                            if (result.merged) {
                                chainReaction = true;
                                chainCount++;
                                
                                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–º–±–æ –∑–∞ —Ü–µ–ø–Ω—É—é —Ä–µ–∞–∫—Ü–∏—é
                                gameState.lastMergeChain++;
                                gameState.combo = Math.min(3.0, 1.0 + gameState.lastMergeChain * 0.1);
                            }
                        }
                    }
                }
                
                if (chainReaction) {
                    applyGravity();
                }
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–º–æ–¥–∑–∏
            gameState.nextEmoji = getRandomEmojiLevel();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã
            if (isGridFull()) {
                endGame();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUI();
            renderGrid();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–ª–∏—è–Ω–∏–µ —ç–º–æ–¥–∑–∏
        function checkAndMerge(startRow, startCol) {
            const emojiLevel = gameState.grid[startRow][startCol];
            if (emojiLevel === 0 || emojiLevel >= EMOJI_LEVELS.length) return { merged: false };
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º 4 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const directions = [
                [-1, 0], // –≤–≤–µ—Ä—Ö
                [1, 0],  // –≤–Ω–∏–∑
                [0, -1], // –≤–ª–µ–≤–æ
                [0, 1]   // –≤–ø—Ä–∞–≤–æ
            ];
            
            for (const [dr, dc] of directions) {
                const newRow = startRow + dr;
                const newCol = startCol + dc;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
                if (newRow >= 0 && newRow < GRID_SIZE && 
                    newCol >= 0 && newCol < GRID_SIZE &&
                    gameState.grid[newRow][newCol] === emojiLevel) {
                    
                    // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å (–Ω–µ –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ)
                    const newLevel = Math.min(emojiLevel + 1, EMOJI_LEVELS.length - 1);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ
                    gameState.grid[startRow][startCol] = newLevel;
                    gameState.grid[newRow][newCol] = 0;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ—á–∫–∏ —Å —É—á–µ—Ç–æ–º –∫–æ–º–±–æ
                    const points = POINTS_PER_LEVEL[emojiLevel - 1] * gameState.combo;
                    gameState.score += Math.round(points);
                    
                    // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç —Å–ª–∏—è–Ω–∏—è
                    const cell1 = document.querySelector(`[data-row="${startRow}"][data-col="${startCol}"]`);
                    const cell2 = document.querySelector(`[data-row="${newRow}"][data-col="${newCol}"]`);
                    
                    if (cell1) cell1.classList.add('merge-effect');
                    if (cell2) cell2.classList.add('merge-effect');
                    
                    setTimeout(() => {
                        if (cell1) cell1.classList.remove('merge-effect');
                        if (cell2) cell2.classList.remove('merge-effect');
                    }, 500);
                    
                    return { merged: true, points: Math.round(points) };
                }
            }
            
            return { merged: false };
        }
        
        // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è - –æ–ø—É—Å–∫–∞–µ–º –≤—Å–µ —ç–º–æ–¥–∑–∏ –≤–Ω–∏–∑
        function applyGravity() {
            for (let col = 0; col < GRID_SIZE; col++) {
                // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –Ω–µ–ø—É—Å—Ç—ã–µ –∫–ª–µ—Ç–∫–∏ –≤ —Å—Ç–æ–ª–±—Ü–µ
                const columnEmojis = [];
                
                for (let row = GRID_SIZE - 1; row >= 0; row--) {
                    if (gameState.grid[row][col] !== 0) {
                        columnEmojis.push(gameState.grid[row][col]);
                        gameState.grid[row][col] = 0;
                    }
                }
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç–æ–ª–±–µ—Ü —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö
                for (let i = 0; i < columnEmojis.length; i++) {
                    gameState.grid[GRID_SIZE - 1 - i][col] = columnEmojis[i];
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –ª–∏ —Å–µ—Ç–∫–∞
        function isGridFull() {
            for (let row = 0; row < GRID_SIZE; row++) {
                for (let col = 0; col < GRID_SIZE; col++) {
                    if (gameState.grid[row][col] === 0) {
                        return false;
                    }
                }
            }
            return true;
        }
        
        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
        function endGame() {
            gameState.gameOver = true;
            
            setTimeout(() => {
                gameScreen.style.opacity = '0';
                gameScreen.style.pointerEvents = 'none';
                
                finalScore.textContent = gameState.score;
                gameOverScreen.style.opacity = '1';
                gameOverScreen.style.pointerEvents = 'auto';
            }, 1000);
        }
        
        // ================= –û–¢–†–ò–°–û–í–ö–ê =================
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            scoreValue.textContent = gameState.score;
            currentScore.textContent = gameState.score;
            nextEmoji.textContent = EMOJI_LEVELS[gameState.nextEmoji - 1];
            comboValue.textContent = 'x' + gameState.combo.toFixed(1);
            movesCount.textContent = gameState.moves;
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏
        function renderGrid() {
            const cells = document.querySelectorAll('.cell');
            
            cells.forEach(cell => {
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                const emojiLevel = gameState.grid[row][col];
                
                // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                cell.innerHTML = '';
                cell.className = 'cell';
                
                if (emojiLevel === 0) {
                    cell.classList.add('empty');
                } else {
                    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å —ç–º–æ–¥–∑–∏
                    const emojiElement = document.createElement('div');
                    emojiElement.className = 'emoji-cell';
                    emojiElement.textContent = EMOJI_LEVELS[emojiLevel - 1];
                    
                    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –¥–ª—è –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏—Ö —É—Ä–æ–≤–Ω–µ–π
                    const size = 1.0 + (emojiLevel - 1) * 0.15;
                    emojiElement.style.fontSize = `${size}rem`;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–µ—á–µ–Ω–∏–µ –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö —É—Ä–æ–≤–Ω–µ–π
                    if (emojiLevel >= 4) {
                        emojiElement.style.textShadow = `0 0 10px rgba(255, 215, 0, 0.7)`;
                    }
                    if (emojiLevel >= 6) {
                        emojiElement.style.textShadow = `0 0 15px rgba(255, 0, 0, 0.8)`;
                    }
                    
                    cell.appendChild(emojiElement);
                    cell.classList.add('filled');
                }
            });
        }
        
        // ================= –§–£–ù–ö–¶–ò–ò –ü–û–î–ï–õ–ò–¢–¨–°–Ø =================
        
        function shareTelegram() {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent(`–Ø –Ω–∞–±—Ä–∞–ª ${gameState.score} –æ—á–∫–æ–≤ –≤ –∏–≥—Ä–µ "–°–º–∞–π–ª–∏"! –ü–æ–ø—Ä–æ–±—É–π –∏ —Ç—ã!`);
            window.open(`https://t.me/share/url?url=${url}&text=${text}`, '_blank');
        }
        
        function shareVK() {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent('–ò–≥—Ä–∞ "–°–º–∞–π–ª–∏"');
            const description = encodeURIComponent(`–Ø –Ω–∞–±—Ä–∞–ª ${gameState.score} –æ—á–∫–æ–≤! –ü–æ–ø—Ä–æ–±—É–π –∏ —Ç—ã!`);
            const image = encodeURIComponent(''); // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–≤—å—é
            
            window.open(`https://vk.com/share.php?url=${url}&title=${title}&description=${description}&image=${image}`, '_blank');
        }
        
        // ================= –ó–ê–ü–£–°–ö –ò–ì–†–´ =================
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', init);
        
        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Å–µ—Ç–∫–∏ –ø–æ–¥ —ç–∫—Ä–∞–Ω
        window.addEventListener('resize', () => {
            const gridSize = Math.min(window.innerWidth * 0.9, 400);
            gameGrid.style.width = `${gridSize}px`;
            gameGrid.style.height = `${gridSize}px`;
        });
        
        // –í—ã–∑—ã–≤–∞–µ–º resize —Å—Ä–∞–∑—É
        window.dispatchEvent(new Event('resize'));
    </script>
</body>
</html>